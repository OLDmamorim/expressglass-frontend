<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
  <title>Portal de Agendamento - Expressglass</title>
  <link rel="stylesheet" href="style.css"/>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#2563eb">

  <!-- >>>>>> APENAS PRINT (não afeta ecrã) <<<<<< -->
  <style>
    /* ... (toda a tua parte de estilos, igual ao backup que enviaste) ... */
  </style>
  <!-- /PRINT -->
</head>
<body>
  <div class="page">
    <!-- ... (todo o conteúdo que já tinhas: header, nav, tabelas, formulários, etc.) ... -->
  </div>

  <script src="api.js"></script>
  <script src="script.js"></script>
  <script src="horizontal-services-layout.js"></script>
  <script src="horizontal-layout-final.js"></script>
  <script src="expressglass-sabado-final.js"></script>
  <script src="expressglass-sabado-automatico-final.js"></script>
  <script src="expressglass-sabado-definitivo.js"></script>

  <!-- >>>>>> SCRIPT DE IMPRESSÃO (mantém igual) <<<<<< -->
  <script>
    /* ... (script de impressão que já tinhas, não alterei nada) ... */
  </script>

  <!-- ===== MOBILE CARD SKIN — FIX NÃO DESTRUTIVO ===== -->
  <script>
  (function(){
    const LIST = document.getElementById('mobileDayList');
    if(!LIST) return;

    const clamp=n=>Math.max(0,Math.min(255,Math.round(n)));
    const hx=n=>n.toString(16).padStart(2,'0');
    const rgbToHex=({r,g,b})=>('#'+hx(clamp(r))+hx(clamp(g))+hx(clamp(b)));
    function parseColor(str){
      if(!str) return null; str=String(str).trim();
      if(str.startsWith('#')){
        if(str.length===4) return {r:parseInt(str[1]+str[1],16),g:parseInt(str[2]+str[2],16),b:parseInt(str[3]+str[3],16)};
        if(str.length>=7)  return {r:parseInt(str.slice(1,3),16), g:parseInt(str.slice(3,5),16), b:parseInt(str.slice(5,7),16)};
      }
      const m=str.match(/rgba?\(\s*(\d+)[,\s]+(\d+)[,\s]+(\d+)/i);
      return m?{r:+m[1],g:+m[2],b:+m[3]}:null;
    }
    const lighten=(rgb,a)=>({r:rgb.r+(255-rgb.r)*a,g:rgb.g+(255-rgb.g)*a,b:rgb.b+(255-rgb.b)*a});
    const darken =(rgb,a)=>({r:rgb.r*(1-a),      g:rgb.g*(1-a),      b:rgb.b*(1-a)      });

    function getBaseColor(locality){
      if(locality && window.LOCALITY_COLORS?.[locality]) return window.LOCALITY_COLORS[locality];
      return '#1e88e5';
    }

    function readItemData(item){
      const header = item.querySelector('.appt-header')?.textContent || '';
      const subTxt = item.querySelector('.appt-sub')?.textContent || '';

      let period='', plate='', service='', car='';
      const split = header.split(' - ');
      if(split[0]) period = split[0].trim();
      if(split[1]){
        const parts = split[1].split('|').map(s=>s.trim());
        plate   = parts[0] || '';
        service = parts[1] || '';
        car     = parts[2] || '';
      }

      let locality='';
      if(subTxt){
        const parts = subTxt.split('|');
        locality = (parts[0] || '').trim();
      }
      return {period, plate, service, car, locality};
    }

    function skinItem(item){
      if(!(item instanceof HTMLElement)) return;
      if(item.dataset.skinned === '1') return;
      if(!item.querySelector('.appt-header') && !item.querySelector('.appt-sub')) return;

      const {locality} = readItemData(item);
      const base = getBaseColor(locality);
      const rgb  = parseColor(base) || parseColor('#1e88e5');
      const c1   = rgbToHex(lighten(rgb, 0.08));
      const c2   = rgbToHex(darken (rgb, 0.15));

      item.classList.add('m-card');
      item.style.setProperty('--c1', c1);
      item.style.setProperty('--c2', c2);

      item.dataset.skinned = '1';
    }

    function apply(){
      LIST.querySelectorAll('.appt-item, li, div, article').forEach(node=>{
        if(node.querySelector?.('.appt-header') || node.querySelector?.('.appt-sub')){
          skinItem(node);
        }
      });
    }

    let t, raf;
    function applySoon(){
      if(raf) cancelAnimationFrame(raf);
      if(t) clearTimeout(t);
      raf = requestAnimationFrame(()=> { t = setTimeout(apply, 30); });
    }

    window.addEventListener('load', applySoon);
    new MutationObserver(applySoon).observe(LIST, {childList:true, subtree:true});
    ['prevDay','nextDay','todayDay','prevWeek','nextWeek','todayWeek']
      .forEach(id => document.getElementById(id)?.addEventListener('click', applySoon));
    setTimeout(applySoon, 120);
    setTimeout(applySoon, 400);
  })();
  </script>
</body>
</html>